import{j as e,f as S,r as d,a as A,b as O,u as G,L as C}from"./index-DKFyDtO4.js";import{B as $}from"./Button-DqdRYTCJ.js";import{useSocket as k}from"./Layout-7g9_KixA.js";function E({image:s,title:l,className:n,mode:a}){return e.jsxs("div",{className:`absolute hover:text-[rgba(251,251,138,0)] duration-500 ${n}`,children:[e.jsx("img",{src:`/assets/images/${s}`,className:"brightness-[.5] hover:scale-[1.04] hover:brightness-100 transition duration-500",alt:"tournament-background"}),e.jsx("h1",{className:`absolute pointer-events-none top-[40%] ${l}`,children:a})]})}function I(){return e.jsxs("div",{className:"relative w-full lg:h-shapes-lg ms:h-shapes-ms font-dreamscape-sans text-primary select-none modes",children:[e.jsx(S,{to:"/CustomTournament",children:e.jsx(E,{image:"tournaments.webp",title:"lg:left-[5%] lp:left-[15%] left-[12%]",className:"w-[67%]",mode:"tournaments"})}),e.jsx(S,{to:"/custom",state:{mode:"training"},children:e.jsx(E,{image:"training.webp",title:"right-[10%]",className:"right-0 w-[42%]",mode:"training"})}),e.jsx(S,{to:"/custom",state:{mode:"1vs1"},children:e.jsx(E,{image:"1vs1.webp",title:"right-[30%]",className:"right-0 w-[53%] lg:bottom-2 lp:bottom-4 tb:bottom-3 ml:bottom-2 ms:bottom-1",mode:"1 vs 1"})})]})}function J({image:s,title:l,requiredXp:n,currentXp:a}){const m=a>=n;return e.jsxs("div",{className:`text-center ${m?"":"grayscale"}`,children:[e.jsx("img",{src:`/assets/images/Achievements/${s}.png`,className:"hover:scale-[1.2] transition duration-500 select-none",alt:`${l} Badge`}),e.jsx("p",{className:"achievements-titles-font font-dreamscape-sans select-none",children:l})]})}function P({achievements:s,currentXp:l}){const[n,a]=d.useState(0);d.useEffect(()=>{const i=Math.min(l/1e4*100,100);n<i&&setTimeout(()=>a(f=>f+1),20)},[n,l]);const m=[{title:"Novice Astronaut",image:"novice-astronaut",requiredXp:0},{title:"Cosmic Explorer",image:"cosmic-explorer",requiredXp:2e3},{title:"Stellar Voyager",image:"stellar-voyager",requiredXp:4e3},{title:"Galactic Trailblazer",image:"galactic-trailblazer",requiredXp:6e3},{title:"Celestial Master",image:"celestial-master",requiredXp:8e3}];return e.jsxs("div",{className:`border rounded-xl achivements-card font-dreamscape-sans
		transition duration-300 border-[rgba(255,206,157,.2)] hover:border-[rgba(255,206,157,.4)]
		bg-[rgba(27,22,17,0.5)] hover:drop-shadow-[0_0_20px_rgba(255,206,157,0.2)]`,children:[e.jsx("h1",{className:"text-primary text-center leading-[1.02] achievements",children:"Achievements"}),e.jsx("div",{className:"flex max-ms:flex-col justify-between items-center text-level",children:m.map(i=>e.jsx(J,{image:i.image,title:i.title,requiredXp:i.requiredXp,currentXp:l},i.title))}),e.jsxs("div",{className:"text-primary levels-font xl:mt-4 lp:mt-3 mtb:mt-2 mt-1",children:[e.jsxs("div",{className:"flex justify-between max-ms:flex-col",children:[e.jsx("p",{children:"0xp"}),e.jsx("p",{children:"2000xp"}),e.jsx("p",{children:"4000xp"}),e.jsx("p",{children:"6000xp"}),e.jsx("p",{children:"8000xp"}),e.jsx("p",{children:"10000xp"})]}),e.jsx("div",{className:"w-full lg:h-2 tb:h-1.5 h-1 rounded-md bg-[rgb(121,118,110,0.7)] mt-[2px] flex items-center",children:e.jsx("div",{className:"rounded-lg h-[100%] bg-level transition-all duration-1000 ease-out",style:{width:`${n}%`}})})]})]})}const X="https://localhost/api/send_friend_request/",z="https://localhost";function M({user_friend:s,user_profile_picture:l,blockedUsers:n}){const{getAuthHeaders:a}=A(),{triggerAlert:m}=O(),{socket_notification:i,sendGameInvite:f}=k(),g=n.some(u=>u.blocked__id===s.id),h=(u,t)=>{m(u,t)},o=async u=>{if(!u){console.error("No user ID provided");return}try{if(g){h("error","Cannot send friend request - user is blocked");return}const t=await fetch(X,{method:"POST",body:JSON.stringify({user_to:u}),headers:a()}),r=await t.json();if(t.status===201){const c=r.from_user,b=r.sender_id,v=r.id,j=r.receiver_id;(i==null?void 0:i.readyState)===WebSocket.OPEN&&(i.send(JSON.stringify({sender_id:b,receiver_id:j,message:`User ${c} sent you a friend request`,id:v,from_user:c,profile_picture:z+l})),h("success","Friend request sent successfully"))}else h("error",r.message)}catch(t){console.error("Error:",t)}},x=async u=>{(i==null?void 0:i.readyState)===WebSocket.OPEN?f(u):h("error","Cannot send invite - connection error")};return e.jsxs("div",{className:`user-container flex items-center justify-between font-dreamscape-sans
            rounded-md hover:bg-[rgba(183,170,156,0.2)]`,children:[e.jsxs("div",{className:"h-full flex items-center xl:gap-3 tb:gap-2 gap-1 w-[72%]",children:[e.jsx("img",{src:s.badge_image,className:"achievement-icon-fr select-none",alt:"achievement-icon",loading:"eager"}),e.jsx("img",{src:s.profile_picture,className:"h-[70%] aspect-square object-cover rounded-full ring-1 ring-primary select-none",alt:"user-image",loading:"eager"}),e.jsxs("div",{className:"flex flex-wrap items-center overflow-hidden",children:[e.jsx("p",{className:"text-primary nickname-size leading-none truncate mr-1",children:s.username}),e.jsx("p",{className:"text-achievement achievement-name ",children:s.badge_name})]})]}),e.jsxs("div",{className:"mx-1 flex items-center gap-2",children:[" ",s.is_friend&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:`
                            ${s.status==="online"?"text-online":s.status==="offline"?"text-offline":"text-defeat"} achievement-name`,children:s.status}),s.status==="online"&&e.jsx($,{className:"font-medium invite-button px-3 py-1 rounded border border-border",onClick:()=>x(s.id),children:"Invite"})]}),!s.is_friend&&e.jsx($,{className:"font-medium invite-button px-2 py-1 rounded border border-border",onClick:()=>o(s.id),disabled:g,children:g?"Blocked":"Add Friend"})]})]})}const W="https://localhost",H="https://localhost/api/chat/blocked/blocked-users/";function Q(){const[s,l]=d.useState([]),[n,a]=d.useState(""),{getAuthHeaders:m}=A(),{profile_picture:i}=k(),[f,g]=d.useState([]),{socket_notify:h,socket_friends:o}=k(),x=async()=>{try{const r=await(await fetch(`${W}/api/users/`,{method:"GET",headers:m()})).json();l(r)}catch(t){console.error("Error:",t)}};d.useEffect(()=>{x()},[]),d.useEffect(()=>{(async()=>{try{const c=await(await fetch(H,{method:"GET",headers:m()})).json();g(c.blocked_users)}catch(r){console.error("Error fetching blocked status:",r)}})()},[]);const u=()=>((s==null?void 0:s.filter(r=>r.username.toLowerCase().startsWith(n.toLowerCase())))||[]).sort((r,c)=>{const b=w=>f.some(U=>U.blocked__id===w),v=b(r.id),j=b(c.id);if(r.is_friend&&!c.is_friend)return-1;if(!r.is_friend&&c.is_friend)return 1;if(r.is_friend&&c.is_friend){if(r.status==="online"&&c.status!=="online")return-1;if(r.status!=="online"&&c.status==="online")return 1}return v&&!j?-1:!v&&j?1:r.username.localeCompare(c.username)});return d.useEffect(()=>{if(!o)return;const t=o.onmessage;return o.onmessage=r=>{JSON.parse(r.data).type==="friend_request_accepted"&&x(),t&&t(r)},()=>{o.onmessage=t}},[o]),d.useEffect(()=>{if(!h)return;const t=h.onmessage;return h.onmessage=r=>{const c=JSON.parse(r.data);(c.message==="online"||c.message==="offline")&&x(),t&&t(r)},()=>{h.onmessage=t}},[h]),e.jsxs("div",{className:`flex flex-col items-center lg:w-fl-ldr-custom w-full mtb:h-card h-[350px] rounded-xl border
            transition duration-300 border-[rgba(255,206,157,.2)] hover:border-[rgba(255,206,157,.4)] bg-[rgba(27,22,17,0.5)]
            hover:drop-shadow-[0_0_20px_rgba(255,206,157,0.2)]`,children:[e.jsx("h1",{className:"font-dreamscape-sans card-title text-primary",children:"STELLAR BUDDIES"}),e.jsxs("div",{className:"flex items-center border border-border rounded-lg pl-2.5 w-[90%]",children:[e.jsx("img",{src:"/assets/images/icons/search-icon.png",className:"search-icon select-none",alt:""}),e.jsx("input",{type:"search",name:"search for friends",placeholder:"Search for friends...",className:"flex-1 font-medium bg-transparent text-primary outline-none search-input p-2.5 placeholder:text-border overflow-hidden",value:n,onChange:t=>a(t.target.value)})]}),e.jsx("div",{className:"w-[96%] overflow-y-auto users",children:u().map(t=>e.jsx(M,{user_friend:t,user_profile_picture:i,badge_image:t.badge_image,badge_name:t.badge_name,blockedUsers:f},t.id))})]})}function V({rank:s,nickname:l,achievement:n,xp:a,profilePicture:m,isCurrentUser:i}){const f=o=>`/assets/images/Achievements/${o.toLowerCase().replace(/\s+/g,"-")}.png`,g=o=>o?o.startsWith("http")?o:`https://localhost${o}`:"/assets/images/default-avatar.png",h=`user-container flex items-center justify-between font-dreamscape-sans
		rounded-md transition-all duration-300
		${i?"bg-[rgba(183,170,156,0.2)] hover:bg-[rgba(183,170,156,0.4)]":"hover:bg-[rgba(183,170,156,0.2)]"}`;return e.jsxs("div",{className:h,children:[e.jsxs("div",{className:"h-full flex items-center xl:gap-3 tb:gap-2 gap-1 w-[68%]",children:[e.jsxs("p",{className:"nickname-size",children:["#",s]}),e.jsx("img",{src:g(m),alt:l,className:"h-[70%] aspect-square object-cover rounded-full ring-1 ring-primary select-none",onError:o=>{o.target.src="/assets/images/default-avatar.png"}}),e.jsxs("div",{className:"flex flex-wrap items-center overflow-hidden",children:[e.jsx("p",{className:"text-primary nickname-size leading-[1] truncate mr-1",children:l}),e.jsx("p",{className:"text-achievement achievement-name",children:n})]})]}),e.jsxs("div",{className:"h-full mx-1 flex flex-col items-center justify-center",children:[e.jsx("img",{src:f(n),alt:n,className:"h-[60%] select-none",onError:o=>{o.target.style.display="none"}}),e.jsx("span",{className:"achievements-titles-font",children:`${a.toLocaleString()}XP`})]})]})}const K=({users:s})=>{const l=G();if(!s)return e.jsx(C,{});const n=a=>{l(`/profile/${a}`)};return e.jsxs("div",{className:`flex flex-col items-center lg:w-fl-ldr-custom w-full mtb:h-card h-[350px] rounded-xl border
		transition duration-300 border-[rgba(255,206,157,.2)] hover:border-[rgba(255,206,157,.4)] bg-[rgba(27,22,17,0.5)]
		hover:drop-shadow-[0_0_20px_rgba(255,206,157,0.2)]`,children:[e.jsx("h1",{className:"font-dreamscape-sans card-title",children:"LEADERBOARD"}),e.jsx("div",{className:"w-[96%] overflow-y-auto users",children:s.map((a,m)=>e.jsx("div",{onClick:()=>n(a.username),className:"cursor-pointer",children:e.jsx(V,{rank:m+1,nickname:a.username,achievement:a.achievement.name.toLowerCase(),xp:a.xp,profilePicture:a.profile_picture,isCurrentUser:a.is_current_user})},a.id))})]})};function Y(s){return e.jsxs("div",{className:"max-lg:pb-[60px]",children:[e.jsx("h1",{className:"message-title font-heavy leading-[3]",children:s.title}),e.jsx("p",{className:"message-body font-medium",children:s.body})]})}const te=()=>{const{authTokens:s,logout:l,getAuthHeaders:n}=A(),[a,m]=d.useState([]),[i,f]=d.useState(null),[g,h]=d.useState(!0),[o,x]=d.useState(null),[u,t]=d.useState([]),[r,c]=d.useState("Dashboard"),[b,v]=d.useState("Welcome to your dashboard!"),[j,w]=d.useState("You have no new achievements to claim.");return d.useEffect(()=>{(async()=>{try{const p="https://localhost",B=`${p}/api/user/me/`,L=await fetch(B,{headers:n()});if(!L.ok)throw new Error("Failed to fetch user data");const N=await L.json();x(N),t(N.badge),c(N.badge.title),w(N.badge.body),v(N.badge.description);const D=`${p}/api/user/leaderboard/`,y=await fetch(D,{method:"GET",credentials:"include",headers:n()}),q=await y.text();if(!y.ok)throw new Error(`Leaderboard fetch failed: ${y.status}`);const T=JSON.parse(q);m(T.users);const R=`${p}/api/user/achievements/`,_=await fetch(R,{method:"GET",credentials:"include",headers:n()});if(!_.ok)throw new Error(`Achievements fetch failed: ${_.status}`);const F=await _.json();f(F.achievements)}catch(p){console.error("Error fetching data:",p),console.error("Full error details:",{message:p.message,stack:p.stack})}finally{h(!1)}})()},[]),g?e.jsx(C,{}):e.jsx(e.Fragment,{children:e.jsxs("section",{className:`flex lg:flex-row flex-col lg:pl-section-lg
			rightside-my lg:mr-modes-right-lg lg:ml-modes-left-lg ml:ml-modes-left-ms ml:mr-modes-right-ms`,children:[e.jsxs("div",{className:"lg:w-5/12 flex flex-col justify-between max-lg:mb-8 max-mtb:mb-4 max-lg:mx-2 lg:pr-cards-lg",children:[e.jsx(Y,{title:r,description:b,body:j}),e.jsxs("div",{className:"flex mtb:flex-row flex-col max-mtb:gap-y-3 lg:gap-x-1 mtb:gap-x-5 gap-x-1 lg:justify-between justify-around max-mtb:pr-0",children:[e.jsx(Q,{}),e.jsx(K,{users:a})]})]}),e.jsxs("div",{className:"flex flex-col flex-1 justify-between max-ml:p-1",children:[e.jsx(I,{}),e.jsx(P,{achievements:i,currentXp:(o==null?void 0:o.xp)||0})]})]})})};export{te as default};
