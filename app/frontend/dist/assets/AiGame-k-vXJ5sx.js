var J=Object.defineProperty;var Q=(l,a,n)=>a in l?J(l,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[a]=n;var U=(l,a,n)=>Q(l,typeof a!="symbol"?a+"":a,n);import{r as d,j as i,u as Z,c as ee}from"./index-DKFyDtO4.js";/* empty css             */import{G as te,T as se}from"./GameScore-BjMi0Jnl.js";import{C as ae}from"./react-confetti.min-DTfgXLFg.js";const B=class B{constructor(a="medium"){this.difficulty=a,this.successfulMovePatterns=new Map,this.consecutiveHits=0,this.params=this.getParams()}getParams(){const a=B.BASE_PARAMS;return{reactionTime:a.reactionTime[this.difficulty],speed:a.speedMultiplier[this.difficulty],noise:a.noiseBase[this.difficulty],learning:a.learningRate[this.difficulty]}}predictBallPosition(a,n,u){let f=[];const h=Array.from(this.successfulMovePatterns.entries()).sort((m,o)=>o[1]-m[1]).slice(0,3);for(let m=0;m<100;m++){const o=Math.random()<this.params.learning&&h.length>0;f.push(o?this.patternPrediction(h):this.physicsPrediction(a,n))}return this.averagePredictions(f,u)}patternPrediction(a){const n=a[Math.floor(Math.random()*a.length)][0],[u,f]=n.split(",").map(Number);return{x:u+(Math.random()-.5)*40,y:f+(Math.random()-.5)*40}}physicsPrediction(a,n){const u=this.calculateNoise();return{x:a.x+n.x*(1+u.x),y:a.y+n.y*(1+u.y)}}averagePredictions(a,n){const u=a.reduce((h,m)=>h+m.x,0)/a.length,f=a.reduce((h,m)=>h+m.y,0)/a.length;return{x:u,y:Math.max(n.height/2,Math.min(f,400-n.height/2))}}calculateNoise(){return{x:(Math.random()-.5)*this.params.noise*2,y:(Math.random()-.5)*this.params.noise*3}}recordHit(a){this.consecutiveHits++;const n=`${Math.round(a.x)},${Math.round(a.y)}`;if(this.successfulMovePatterns.set(n,(this.successfulMovePatterns.get(n)||0)+1),this.successfulMovePatterns.size>50){const u=Array.from(this.successfulMovePatterns.keys())[0];this.successfulMovePatterns.delete(u)}}recordMiss(){this.consecutiveHits=0}getAdjustedSpeed(a){return a*this.params.speed}};U(B,"BASE_PARAMS",{reactionTime:{easy:600,medium:300,hard:100},speedMultiplier:{easy:1,medium:.7,hard:.5},noiseBase:{easy:.3,medium:.15,hard:.05},learningRate:{easy:.2,medium:.4,hard:.6}});let D=B;const ie=({isPaused:l,handlePause:a,backgroundId:n,updateScore:u,isGameOver:f,resetParameters:h,difficulty:m})=>{const[o]=d.useState({width:800,height:400}),j=d.useRef(null),C=d.useRef(null),v=d.useRef(null),w=d.useRef(null),S=d.useRef(null);S.current||(S.current=new D(m));const t={paddleWidth:16,paddleHeight:80,paddleX:5,ballRadius:10,ballInitialSpeed:2,ballAcceleration:.05,paddleSpeed:600,maxBallSpeed:10,maxCanvasWidth:1200,playerColor:"#FFFFFF",aiColor:"#FF0000",ballColor:"#FFFFFF"},[M,A]=d.useState(200-t.paddleHeight/2),[x,P]=d.useState(200-t.paddleHeight/2),[H,E]=d.useState(!1),[R,Y]=d.useState(!1),N=d.useRef([{x:o.width/2,y:o.height/2,radius:t.ballRadius,speed:t.ballInitialSpeed,velocityX:Math.random()>.5?5:-5,velocityY:(Math.random()-.5)*8,color:t.ballColor}]);return d.useEffect(()=>{const c=j.current.getContext("2d"),p=S.current,I=(e,r,s)=>{e.velocityX=-e.velocityX,s&&p.recordHit({x:e.x,y:e.y},r.y),r.x<o.width/2?e.x=r.x+r.width+e.radius:e.x=r.x-e.radius,e.speed=Math.min(e.speed+t.ballAcceleration,t.maxBallSpeed)},k=e=>{if(l||f)return;const r=(e-w.current)/1e3;w.current=e,N.current.forEach(s=>{const g=s.x+s.velocityX*s.speed,X=s.y+s.velocityY*s.speed;X+s.radius>o.height||X-s.radius<0?(s.velocityY=-s.velocityY,s.y=X+s.radius>o.height?o.height-s.radius:s.radius):s.y=X;const L=p.predictBallPosition({x:s.x,y:s.y},{x:s.velocityX*s.speed,y:s.velocityY*s.speed},{height:t.paddleHeight}),_=p.getAdjustedSpeed(t.paddleSpeed)*r,q=L.y-t.paddleHeight/2-x;if(Math.abs(q)>5){const K=Math.sign(q)*Math.min(Math.abs(q)*.5,_);P(V=>Math.max(0,Math.min(o.height-t.paddleHeight,V+K)))}const b={x:t.paddleX,y:M,width:t.paddleWidth,height:t.paddleHeight},O={x:o.width-t.paddleWidth-t.paddleX,y:x,width:t.paddleWidth,height:t.paddleHeight};if(T(s,b)?I(s,b,!1):T(s,O)?I(s,O,!0):s.x=g,s.x<0||s.x>o.width){const z=s.x<0?"ai":"player";z==="ai"?p.recordHit({x:s.x,y:s.y},x):p.recordMiss(),u(z),y()}}),H&&A(s=>Math.max(s-t.paddleSpeed*r,0)),R&&A(s=>Math.min(s+t.paddleSpeed*r,o.height-t.paddleHeight)),G(),v.current=requestAnimationFrame(k)},G=()=>{if(c.clearRect(0,0,o.width,o.height),n){const e=new Image;e.src=`/assets/images/tables/table${n}.${n>6?"gif":"webp"}`,c.drawImage(e,0,0,o.width,o.height)}W(t.paddleX,M,t.playerColor),W(o.width-t.paddleWidth-t.paddleX,x,t.aiColor),N.current.forEach($)},W=(e,r,s)=>{c.fillStyle=s,c.beginPath();const g=8;c.moveTo(e+g,r),c.lineTo(e+t.paddleWidth-g,r),c.quadraticCurveTo(e+t.paddleWidth,r,e+t.paddleWidth,r+g),c.lineTo(e+t.paddleWidth,r+t.paddleHeight-g),c.quadraticCurveTo(e+t.paddleWidth,r+t.paddleHeight,e+t.paddleWidth-g,r+t.paddleHeight),c.lineTo(e+g,r+t.paddleHeight),c.quadraticCurveTo(e,r+t.paddleHeight,e,r+t.paddleHeight-g),c.lineTo(e,r+g),c.quadraticCurveTo(e,r,e+g,r),c.closePath(),c.fill()},$=e=>{c.beginPath(),c.arc(e.x,e.y,e.radius,0,Math.PI*2),c.fillStyle=e.color,c.fill(),c.closePath()},T=(e,r)=>e.x+e.radius>r.x&&e.x-e.radius<r.x+r.width&&e.y+e.radius>r.y&&e.y-e.radius<r.y+r.height,y=()=>{const e=(Math.random()-.5)*Math.PI/2;N.current=[{x:o.width/2,y:o.height/2,radius:t.ballRadius,speed:t.ballInitialSpeed,velocityX:Math.cos(e)*(Math.random()>.5?1:-1)*5,velocityY:Math.sin(e)*5,color:t.ballColor}]};return v.current=requestAnimationFrame(k),()=>cancelAnimationFrame(v.current)},[l,f,M,x,n]),d.useEffect(()=>{const F=p=>{p.key==="ArrowUp"&&E(!0),p.key==="ArrowDown"&&Y(!0)},c=p=>{p.key==="ArrowUp"&&E(!1),p.key==="ArrowDown"&&Y(!1)};return window.addEventListener("keydown",F),window.addEventListener("keyup",c),()=>{window.removeEventListener("keydown",F),window.removeEventListener("keyup",c)}},[]),i.jsxs("div",{ref:C,className:"flex flex-col items-center gap-7 max-lg:order-first max-lg:w-full",children:[i.jsxs("div",{className:`relative aspect-video bg-cover bg-center border rounded-2xl overflow-hidden
					${l?"brightness-[20%]":"brightness-[1]"}`,style:{width:"clamp(18.125rem, 40.265vw + 10.575rem, 75rem)",maxWidth:`${t.maxCanvasWidth}px`},children:[i.jsx("div",{className:"absolute inset-0 bg-cover bg-center brightness-50 rounded-2xl",style:{backgroundImage:`url('/assets/images/tables/table${n}.${n>6?"gif":"webp"}')`}}),i.jsx("canvas",{ref:j,width:o.width,height:o.height,className:"absolute top-0 left-0 rounded-2xl",style:{width:"100%",height:"100%"}})]}),l&&i.jsx("div",{children:i.jsx("p",{className:`text-[100px] font-dreamscape text-center leading-[1.01] game-paused
							absolute transform top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2`,children:"GAME PAUSED"})}),!f&&i.jsxs("button",{onClick:a,className:"pause flex items-center gap-3 brightness-[1] leading-[0.95]",children:[i.jsx("img",{src:`/assets/images/icons/${l?"play":"pause"}.svg`,alt:"pause icon"}),i.jsx("p",{className:"align-middle",children:l?"resume":"pause"})]})]})},re=({winner:l,onRestart:a,onClose:n})=>i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 z-10"}),i.jsxs("div",{className:`absolute top-[44%] left-1/2 transform -translate-x-1/2 -translate-y-1/2 lp:px-10 px-3 z-20
			flex flex-col justify-center items-center gameoverpopup`,children:[l?i.jsx("h1",{className:"font-dreamscape",children:"VICTORY ACHIEVED"}):i.jsx("h1",{className:"font-dreamscape",children:"GAME OVER"}),l?i.jsxs("div",{className:"font-heavy",children:[i.jsx("p",{className:"text-left",children:"Cosmic Champion:"}),i.jsx("h3",{className:"players-usernames font-dreamscape-sans pt-3 pb-7 text-center glow drop-shadow-[0_2px_10px_rgba(255,206,158,0.5)]",children:l.name}),i.jsx("p",{className:"text-center",children:"Your stellar skills have conquered the arena!"})]}):i.jsx("p",{className:"font-medium",children:"A cosmic deadlock! The match ends in a tie."}),i.jsxs("div",{className:"w-full flex justify-between my-10 lg:gap-10 gap-6",children:[i.jsx("button",{onClick:a,className:`font-dreamscape bg-primary text-secondary py-3 flex-1 rounded
					hover:scale-[1.03] hover:brightness-100 transition-all duration-300 ease-in-out`,children:"Play Again"}),i.jsx("button",{onClick:n,className:`font-heavy text-primary py-3 border border-border rounded flex-1
					bg-[rgb(183,170,156,12%)] transition-all duration-300 ease-in-out hover:bg-[rgb(183,170,156,30%)]`,children:"Personalize Game"})]})]})]}),pe=()=>{var T;const l=Z(),n=((T=ee().state)==null?void 0:T.backgroundId)||3,[u,f]=d.useState("easy"),[h,m]=d.useState(!1),[o,j]=d.useState(!1),[C,v]=d.useState(0),[w,S]=d.useState(0),[t,M]=d.useState(!1),[A,x]=d.useState(null),[P,H]=d.useState(60),[E,R]=d.useState(!1),[Y,N]=d.useState(!1),F="#FFFFFF",c="#FF0000",p=()=>{o||m(!h)},I=y=>{y==="player"?v(e=>e+1):y==="ai"&&S(e=>e+1)};d.useEffect(()=>{if(!(h||o))if(P>0){const y=setInterval(()=>{H(e=>e-1)},1e3);return()=>clearInterval(y)}else P===0&&$()},[P,h,o]);const k=()=>C>w?{name:"Player"}:w>C?{name:"AI"}:null,G=()=>{R(!1),l("/custom",{state:{mode:"AI"}})},W=()=>{v(0),S(0),H(60),j(!1),m(!1),R(!1),N(y=>!y),x(null)},$=()=>{j(!0),m(!0),R(!0),x(k()),M(!0),setTimeout(()=>M(!1),5e3)};return i.jsxs(i.Fragment,{children:[i.jsx("section",{className:`relative flex-1 margin-page flex flex-col items-center gap-8 ${h?"bg-backdrop-40":""}`,children:i.jsxs("div",{className:"flex-1 margin-page flex flex-col items-center gap-8",children:[i.jsx(te,{player1Score:C,player2Score:w,isPaused:h}),i.jsx(se,{isPaused:h,timeRemaining:P}),i.jsx("div",{className:"flex-1 w-full flex max-lg:flex-wrap max-lg:justify-around justify-between font-dreamscape-sans",children:i.jsx(ie,{isPaused:h,handlePause:p,backgroundId:n,updateScore:I,isGameOver:o,resetParameters:Y,player1Color:F,player2Color:c,difficulty:u})})]})}),E&&i.jsx(re,{winner:A,onRestart:W,onClose:G}),A&&t&&i.jsx(ae,{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:20},recycle:!1,numberOfPieces:500})]})};export{pe as default};
