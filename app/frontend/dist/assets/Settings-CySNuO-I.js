import{j as e,r,a as ne,b as ie,h as O}from"./index-B4bz0GvT.js";import{B as j}from"./Button-DzeJS1SW.js";import{a as C}from"./axios-upsvKRUO.js";import{useSocket as ce}from"./Layout-D37kEgpn.js";const de=({dialogRef:u,closeDialog:c,setTwoFactorAuthEnabled:d,send2faAxiosRequest:l})=>{const i=()=>{d(!1),l(!1),c()};return e.jsx("dialog",{id:"dialog",ref:u,className:`dialog-shape max-w-full text-primary
			bg-transparent backdrop:bg-[rgba(0,0,0,.6)] backdrop:backdrop-blur-md`,onClick:n=>{const x=n.currentTarget.getBoundingClientRect();(n.clientX<x.left||n.clientX>x.right||n.clientY<x.top||n.clientY>x.bottom)&&c()},children:e.jsxs("div",{className:"flex flex-col gap-8",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h1",{className:"dialog-title font-heavy text-light",children:"Disable Two-Factor Authentication"}),e.jsx("p",{className:"font-regular paragraph",children:"Are you sure you want to disable Two-Factor Authentication?"})]}),e.jsx("button",{onClick:i,className:`border border-border select-none py-2 px-8 my-6 self-end paragraph font-medium outline-none rounded
					buttons-text remove-button bg-[rgb(183,170,156,12%)] transition-all duration-300 ease-in-out hover:bg-[rgb(183,170,156,30%)]`,children:"Disable"})]})})},ue=({dialogRef:u,closeDialog:c,onDelete:d})=>e.jsx("dialog",{ref:u,className:"dialog-shape bg-transparent backdrop:bg-[rgba(0,0,0,.6)] backdrop:backdrop-blur-md text-primary",onClick:l=>{const i=l.currentTarget.getBoundingClientRect();(l.clientX<i.left||l.clientX>i.right||l.clientY<i.top||l.clientY>i.bottom)&&c()},children:e.jsxs("div",{className:"flex flex-col gap-8",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h1",{className:"dialog-title font-heavy text-red-600",children:"Delete Account"}),e.jsx("p",{className:"font-regular paragraph",children:"Are you sure you want to delete your account? This action cannot be undone and all your data will be permanently lost."})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:c,className:`rounded border-border font-regular buttons-text remove-button border
						bg-[rgb(183,170,156,12%)] transition-all duration-300 ease-in-out hover:bg-[rgb(183,170,156,30%)]`,children:"Cancel"}),e.jsx("button",{onClick:()=>{d(),c()},className:`rounded border-red-600 font-regular buttons-text remove-button border
						transition duration-300 select-none bg-red-600 bg-opacity-10 hover:bg-red-600 active:bg-red-700`,children:"Delete Account"})]})]})}),k="https://localhost/api/user/",me="/profile_pictures/avatar.jpg",pe="https://localhost";function f({id:u,type:c,label:d,placeholder:l,value:i,onChange:n}){return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:u,className:"font-regular text-light sections-title",children:d}),e.jsx("input",{id:u,name:u,type:c,placeholder:l,className:`inputs border border-border rounded bg-[rgb(183,170,156,8%)] transition-all duration-300
				placeholders outline-none max-ms:w-[80%] text-border`,onChange:n,value:i||""})]})}const he=()=>{const{refreshUserData:u,fetchUser:c}=ce(),d=r.useRef(null),l=r.useRef(null),[i,n]=r.useState(!1),x=()=>{d.current&&d.current.showModal()},$=()=>{d.current.close()},A=a=>{C.post(k+"2fa/",{"2fa_status":a},{headers:_()}).then(t=>{t.status===200&&console.log("response ----->",t.data)}).catch(t=>{var s;if(t.response){const y=((s=t.response.data)==null?void 0:s.error)||"Failed to enable 2FA";m("error",y)}else t.request?m("error","No response from the server"):m("error",t.message)})},H=()=>{l.current&&l.current.showModal()},J=()=>{l.current&&l.current.close()},K=()=>{i?x():(n(!0),A(!0))};window.addEventListener("load",function(){var a=document.getElementById("resetButton");a.addEventListener("click",function(){for(var t=document.getElementsByTagName("form"),s=0;s<t.length;s++)t[s].reset()})});const[o,S]=r.useState({first_name:"",last_name:"",email:"",mobile_number:"",username:"",bio:"",password:"",new_password:"",confirm_password:"",profile_picture:"",is_logged_with_oauth_for_2fa:!1}),[g,P]=r.useState(""),[b,D]=r.useState(""),[E,F]=r.useState(""),[R,U]=r.useState(""),[h,B]=r.useState(""),[I,L]=r.useState(""),[Q,T]=r.useState(""),[V,w]=r.useState(null),[W,v]=r.useState(null),[Z,N]=r.useState(!1),[M,z]=r.useState(""),[X,Y]=r.useState(""),[q,G]=r.useState(""),{getAuthHeaders:_}=ne(),{triggerAlert:m}=ie();function ee(){const a=O.get();for(const t in a)a.hasOwnProperty(t)&&O.remove(t)}const te=()=>{C.delete(k+"delete/",{headers:{Authorization:_().Authorization}}).then(a=>{a.status===200&&(m("success","Account deleted successfully"),setTimeout(()=>{ee(),window.location.href="/"},1e3))})};r.useEffect(()=>{(async()=>{const t=await c();t!=null&&t.is_2fa_enabled?n(!0):n(!1),t&&S(t)})()},[]),r.useEffect(()=>{o&&(P(o.first_name),D(o.last_name),F(o.email),U(o.mobile_number),B(o.username),L(o.bio),z(o.password),Y(o.new_password),G(o.confirm_password),T(o.profile_picture))},[o]);const se=(a,t)=>{const s=new FormData;if(!a)return s;if(s.append("first_name",g.length>10?g.slice(0,10):g||""),s.append("last_name",b.length>10?b.slice(0,10):b||""),s.append("email",E||""),s.append("mobile_number",R||""),s.append("username",h.length>10?h.slice(0,10).toLowerCase():h.toLowerCase()||""),s.append("bio",I||""),s.append("password",M||""),s.append("new_password",X||""),s.append("confirm_password",q||""),t){if(t.size>5*1024*1024)return m("error","Image size must be less than 5MB"),null;s.append("profile_picture",t)}else Z&&s.append("remove_profile_picture",!0);return s},ae=async()=>{const a=se(o,W);a&&C.put(k,a,{headers:{"Content-Type":"multipart/form-data",Authorization:_().Authorization}}).then(t=>{t.status===200&&(S(t.data),v(null),w(null),N(!1),m("success","User data updated successfully"),u())}).catch(t=>{var s;if(t.response){const y=((s=t.response.data)==null?void 0:s.error)||"Failed to update user data";m("error",y)}else t.request?m("error","No response from the server"):m("error",t.message)})},p=a=>{a.target.classList.replace("text-border","text-primary");const{name:t,value:s}=a.target;switch(t){case"first_name":P(s);break;case"last_name":D(s);break;case"email":F(s);break;case"mobile_number":U(s);break;case"username":B(s);break;case"bio":L(s);break;case"password":z(s);break;case"new_password":Y(s);break;case"confirm_password":G(s);break}},re=a=>{document.getElementById("profile_picture").click()},le=a=>{const t=a.target.files[0];t&&(w(URL.createObjectURL(t)),v(t),N(!1))};function oe(){w(null),v(null),T(me),N(!0)}return e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"flex justify-center",children:e.jsxs("div",{className:"s max-tb:h-auto card-margin w-full border border-primary rounded-3xl bg-[rgba(27,22,17,0.5)]",children:[e.jsx("div",{className:"flex items-center card-header sections-ml",children:e.jsx("h1",{className:"font-dreamscape-sans text-primary leading-[1]",children:"Settings"})}),e.jsx("div",{className:"h-0.5 separators"}),e.jsxs("div",{className:`sections-ml flex tb:flex-row flex-col items-center picture-section
						xl:gap-[110px] lg:gap-[50px] tb:gap-[20px] max-tb:gap-y-3`,children:[e.jsxs("div",{className:"font-regular sections-title tb:self-center self-start parts tb:max-w-[30%] w-full",children:[e.jsx("p",{className:"text-primary",children:"Profile Picture"}),e.jsx("p",{className:"text-light",children:"Must be JPEG, PNG, or GIF and cannot exceed 5MB."})]}),e.jsxs("div",{className:"flex items-center max-ms:flex-col lp:gap-14 tb:gap-8 gap-5",children:[e.jsx("div",{children:e.jsx("img",{src:V||`${pe}${Q}`,className:"rounded-full object-cover border-1.5 border-border profile-pic",alt:"Profile Picture"})}),e.jsxs("div",{className:"flex max-ms:flex-col lp:gap-2 gap-1",children:[e.jsx("input",{type:"file",id:"profile_picture",name:"profile_picture",className:"hidden",onChange:le}),e.jsx(j,{className:"rounded border border-border font-medium buttons-text update-button",onClick:re,children:"Update Profile Picture"}),e.jsx(j,{className:"rounded border border-border font-medium buttons-text remove-button",onClick:oe,children:"Remove"})]})]})]}),e.jsx("div",{className:"h-0.5 separators"}),e.jsxs("div",{className:`sections-ml flex tb:flex-row flex-col items-center picture-section
						xl:gap-[110px] lg:gap-[50px] tb:gap-[20px] max-tb:gap-y-3`,children:[e.jsxs("div",{className:"font-regular sections-title tb:self-center self-start parts tb:max-w-[30%] w-full",children:[e.jsx("p",{className:"text-primary",children:"Personal Settings"}),e.jsx("p",{className:"text-light",children:"Change identifying details for your account."})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("form",{id:"form1",className:"flex flex-col lp:gap-4 gap-2",children:[e.jsxs("div",{className:"flex flex-wrap xl:gap-12 lg:gap-4 gap-2",children:[e.jsx(f,{id:"first_name",type:"text",label:"First Name",onChange:p,value:g}),e.jsx(f,{id:"last_name",type:"text",label:"Last Name",onChange:p,value:b})]}),e.jsxs("div",{className:"flex flex-wrap xl:gap-12 lg:gap-4 gap-2",children:[e.jsx(f,{id:"email",type:"email",label:"Email",onChange:p,value:E}),e.jsx(f,{id:"mobile_number",type:"text",label:"Phone Number",onChange:p,value:R})]})]})})]}),e.jsx("div",{className:"h-0.5 separators"}),e.jsxs("div",{className:`sections-ml flex tb:flex-row flex-col items-center picture-section
						xl:gap-[110px] lg:gap-[50px] tb:gap-[20px] max-tb:gap-y-3`,children:[e.jsxs("div",{className:"font-regular sections-title tb:self-center self-start parts tb:max-w-[30%] w-full",children:[e.jsx("p",{className:"text-primary",children:"Profile Settings"}),e.jsx("p",{className:"text-light ",children:"Edit your username and other public details."})]}),e.jsx("div",{className:"flex items-center",children:e.jsx("form",{id:"form2",className:"flex flex-col lp:gap-4 gap-2",children:e.jsxs("div",{className:"flex flex-wrap xl:gap-12 lg:gap-4 gap-2",children:[e.jsx("div",{className:"flex flex-col gap-3",children:e.jsx(f,{id:"username",type:"text",label:"Username",onChange:p,value:h})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"",className:"font-regular text-light sections-title",children:"Bio"}),e.jsx("textarea",{name:"bio",id:"bio",maxLength:"150",className:`bio-input font-regular border border-border rounded bg-[rgb(183,170,156,8%)] min-h-5
											text-border max-ms:w-full outline-none placeholders transition-all duration-300`,onChange:p,value:I})]})]})})})]}),e.jsx("div",{className:"h-0.5 separators"}),e.jsxs("div",{className:`sections-ml flex tb:flex-row flex-col items-center picture-section
						xl:gap-[110px] lg:gap-[50px] tb:gap-[20px] max-tb:gap-y-3`,children:[e.jsxs("div",{className:"font-regular sections-title tb:self-center self-start parts tb:max-w-[30%] w-full",children:[e.jsx("p",{className:"text-primary",children:"Security Settings"}),e.jsx("p",{className:"text-light",children:`Update your password, ${o.is_logged_with_oauth_for_2fa?"":"enable two-factor authentication (2FA), "}or delete your account.`})]}),e.jsxs("div",{className:"flex flex-col lp:gap-6 gap-4",children:[e.jsxs("div",{className:"flex flex-wrap xl:gap-12 lg:gap-4 gap-2",children:[e.jsx(f,{id:"password",type:"password",label:"Current Password",placeholder:"•••••••••••••",onChange:p,value:M}),e.jsx(f,{id:"new_password",type:"password",label:"New Password",placeholder:"••••••••••",onChange:p,value:X}),e.jsx(f,{id:"confirm_password",type:"password",label:"Confirm New Password",placeholder:"••••••••••",onChange:p,value:q})]}),e.jsxs("div",{className:"flex gap-4",children:[o.is_logged_with_oauth_for_2fa?null:e.jsx(j,{className:"rounded border border-border font-medium buttons-text remove-button",type:"submit",onClick:K,disabled:i,from:"settings",children:"Enable Two-factor Authentication"}),e.jsx("button",{className:`rounded border-red-600 font-regular buttons-text remove-button border 
								transition duration-300 select-none bg-red-600 bg-opacity-10 hover:bg-red-600 active:bg-red-700`,onClick:H,children:"Delete Account"})]})]})]}),e.jsx("div",{className:"flex justify-end save-button my-3 tb:gap-2 gap-1",children:e.jsx(j,{className:"rounded border border-border font-medium buttons-text remove-button",type:"submit",onClick:ae,children:"Save Changes"})})]})}),e.jsx(de,{dialogRef:d,closeDialog:$,setTwoFactorAuthEnabled:n,send2faAxiosRequest:A}),e.jsx(ue,{dialogRef:l,closeDialog:J,onDelete:te})]})};export{he as default};
